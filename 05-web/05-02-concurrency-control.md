# 06-02 동시성 제어

### Q. 동시에 여러 사용자가 같은 ID로 회원가입을 시도할 때 발생할 수 있는 문제점은 무엇이며, 어떻게 해결 할 수 있을까요?

동시에 여러 사용자가 같은 ID로 회원가입을 시도하는 상황에서는 `Race Condition`이 발생할 수 있습니다.

예를 들어, A와 B 사용자가 동시에 'user123'이라는 ID로 가입을 시도한다고 가정했을때, 두 사용자가 거의 동시에 ID 중복 체크를 하면, 둘 다 해당 ID가 존재하지 않는다고 판단하고 회원가입을 진행할 수 있습니다. 이런 경우 데이터 정합성이 깨질 수 있습니다. 이를 해결하기 위한 방법으로는 크게 세 가지를 고려할 수 있습니다.

첫째, 가장 쉬운 방법으로 **데이터베이스 컬럼에 유니크 제약조건**을 설정하는 방법입니다. ID 컬럼에 `unique constraint`를 걸어두면, 중복 데이터 삽입 시도 시 에러가 발생하여 하나의 회원만 가입되도록 보장할 수 있습니다.

두번째, 애플리케이션 레벨에서 `ConcurrentHashMap`을 사용하여 `atomic`한 처리를 할 수 있습니다. `putIfAbsent()` 메소드를 활용하면 체크와 등록을 원자적으로 수행할 수 있어서 안전합니다.

세번째, MSA같은 분산 환경에서는 `Redis`를 활용한 **분산 락**을 고려할 수 있습니다.

실제 프로젝트에서는 이러한 방법들을 상황에 맞게 조합하여 사용하는 것이 좋습니다. 저는 주로 데이터베이스의 유니크 제약조건을 기본으로 하고, 추가적인 안정장치로 애플리케이션 레벨에 `ConcurrnetHashMap`을 구현하는 방식을 선호합니다.
