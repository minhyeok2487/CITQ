# 04-04. 힙(Heap) 자료구조

### Q. 힙(Heap)자료구조에 대해서 설명해주세요

`힙(Heap)`은 **데이터를 특정 규칙에 따라 나무 모양으로 저장하는 자료구조 입니다. 주로 가장 크거나 가장 작은 데이터를 빠르게 찾아야 할 때 사용합니다.** 그래서 힙은 크게 두 가지 종류가 있습니다.

첫번째로 `최대 힙 (Max Heap)`은 부모 노드가 자식 노드보다 항상 크거나 같도록 구성된 트리입니다. 루트 노드에는 가장 큰 값이 위치합니다.\
두번째로 `최소 힙 (Min Heap)`은 부모 노드가 자식 노드보다 항상 작거나 같도록 구성된 트리입니다. 루트 노드에는 가장 작은 값이 위치합니다.

힙은 데이터를 추가하거나 삭제할 때 효율적입니다. 시간 복잡도가 `O(log N)` 이여서 대략 데이터가 1000개 있으면 10번 정도의 계산으로 처리 할 수 있고, 데이터가 100만 개 있어도 20번 정도의 계산으로 처리할 수 있을 만큼 빠릅니다.

이런 특성 때문에 힙은 **우선순위 큐를 만들 때 사용**됩니다. 특정 우선 순위가 높은 데이터를 뽑아야 할 때, 힙을 사용하면 가장 우선순위가 높은 데이터를 효율적으로 뽑을 수 있습니다.



### Q. 힙의 삽입 연산의 시간 복잡도가 log n 이라고 하셨는데, 어떻게 log n 이 나오는지 설명해주실 수 있나요?

새로운 데이터가 들어오면, 일단 힙의 가장 마지막 자리에 추가합니다. 이런 삽입 자체는 `O(1)`의 시간이 걸립니다. 그 다음, 자신의 부모 노드와 값을 비교해서, 만약 최대 힙에서 새 데이터가 부모보다 크다면 둘의 자리를 바꿉니다. 이 과정을 마치 제자리를 찾아 나무를 한 칸씩 올라가듯이, 루트에 도달하거나 자신보다 큰 부모를 만날 때까지 반복합니다.

힙은 데이터 N개에 대해 높이가 약 logN인 완전 이진 트리 구조를 유지하므로, 최악의 경우에도 이 비교 및 교환 과정은 트리의 높이만큼만 일어나게 됩니다. 그래서 **최종 시간 복잡도가 O(logN)** 이 되는 것입니다.

추가로 힙의 높이가 logN에 가까운 이유는, 트리의 레벨이 하나 깊어질 때마다 저장 가능한 노드의 수가 두 배씩 늘어나는 구조이기 때문입니다. 반대로 말하면, 데이터의 개수가 두 배로 늘어나도 높이는 겨우 1만 증가하는 셈이죠.



### Q. 실시간 시스템에서 우선순위 큐를 구현할 때 힙 대신 레드-블랙 트리(Red-Black Tree)와 같은 균형 이진 탐색 트리를 사용하는 경우도 있습니다. 힙과 레드-블랙 트리가 우선순위 큐 구현 시 각각 어떤 장단점을 가지는지 비교 설명해주세요.&#x20;

먼저 `힙(Heap)`은 우선순위 큐의 **'가장 높은/낮은 우선순위의 요소를 빠르게 조회하고 삭제'하는 데 최적화**되어 있습니다. 삽입과 삭제 모두 `O(logN)`의 시간 복잡도를 가지며, 가장 중요한 장점은 구현이 비교적 간단하고 메모리 공간 효율성이 뛰어나다는 점입니다. 특히 배열로 구현될 경우 참조 지역성(locality of reference)이 좋아 캐시 효율도 높습니다. 힙은 오직 루트 노드에만 '가장 우선순위가 높은' 값이 있음을 보장하고, 나머지 노드들은 부모-자식 관계의 우선순위만 만족하면 되기 때문에 전체 데이터가 항상 정렬된 상태일 필요가 없습니다. 이 점이 '최대/최소값'만을 빠르게 찾으려는 목적에 부합합니다.

반면 `레드블랙 트리`는 이진 탐색 트리의 일종으로, **모든 노드가 정렬된 상태를 유지하도록 균형을 자동으로 맞춰주는 자료구조**입니다. 삽입, 삭제, 검색 모두 `O(logN)`의 시간 복잡도를 보장합니다. 힙과 비교했을 때 레드블랙 트리의 가장 큰 장점은 **'특정 범위 내의 요소 검색'** 이나 **'임의의 요소 검색 및 삭제'** 에 강하다는 점입니다. 힙은 루트 노드 외의 다른 노드에 접근하는 데 비효율적인 반면, **레드블랙 트리는 전체 데이터가 정렬된 상태로 유지**되므로, 우선순위가 가장 높은 요소뿐만 아니라 두 번째, 세 번째 우선순위 요소 또는 특정 값보다 크거나 작은 모든 요소를 효율적으로 찾을 수 있습니다. 하지만 힙보다 구현이 복잡하고, 각 노드에 색상 정보를 저장하는 오버헤드가 있어 힙보다는 메모리 사용량이 미세하게 더 많을 수 있습니다.

따라서 단순히 가장 높은 우선순위의 요소만 빠르게 처리하면 되는 시스템이라면 힙이 더 효율적이고 간단한 선택입니다. 하지만 우선순위 큐의 기능 외에 특정 범위 탐색이나 임의의 요소에 대한 정렬된 접근이 빈번하게 필요하다면 레드블랙 트리가 더 적합할 수 있습니다.



### Q. 힙 또는 레드-블랙 트리 같은 자료구조가 실제로 복잡한 시스템에서 어떻게 활용될 수 있는지 구체적인 시나리오를 들어 설명해 줄 수 있나요?

힙이나 레드-블랙 트리 같은 자료구조는 복잡한 시스템에서 성능과 안정성을 좌우하는 중요한 역할을 합니다. 예를 들어 MMORPG 같은 대규모 온라인 게임 서버를 생각해보면, 수천에서 수만 개의 비동기 이벤트. 예를 들어 몬스터의 행동, 플레이어 스킬 쿨타임, 버프 만료 등을 실시간으로 처리해야 합니다.

이런 이벤트는 핵심적으로 **'언제 실행되어야 하는가'** 라는 시간이 중요합니다. 그래서 서버는 이벤트들을 시간 기준으로 정렬해서 관리하는 우선순위 큐가 필요하고, 이때 힙 자료구조가 적합합니다. 최소 힙을 사용하면 가장 빠른 시점에 실행되어야 할 이벤트가 항상 루트에 위치하게 되므로, `O(logN)`의 시간 복잡도로 다음 이벤트를 꺼내고 처리할 수 있습니다.

예를 들어 몬스터가 공격한 뒤, 2초 뒤에 다음 행동을 한다고 하면, '현재 시각 + 2초'를 기준으로 이벤트를 힙에 넣어두는 방식입니다. 서버는 매 틱마다 힙 루트를 확인해서 실행 시각이 현재 시각을 지났다면 해당 이벤트를 처리하고, 필요하다면 다음 행동도 다시 힙에 등록합니다.

이 방식의 장점은 수만 개의 이벤트 중에서도 **'가장 먼저 처리할 것'만 빠르게 선택**할 수 있다는 점입니다. 전부를 순회할 필요가 없고, 매우 효율적인 구조죠.

그래서 힙은 이렇게 시간 기반 스케줄링이 필요한 시스템에서 실질적으로 많이 사용됩니다.
