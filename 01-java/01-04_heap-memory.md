# 01-04. 힙(Heap)과 메모리(Memory)

### Q. 자바의 메모리 구조에 대해 설명해주세요.

자바의 메모리 구조는 크게 세 가지 주요 영역으로 나눌 수 있습니다. `스택(Stack)`, `힙(Heap)`, 그리고 `메서드 영역(Method Area)`입니다.

먼저, `스택`은 **각 스레드마다 하나씩 존재하는 영역**입니다. 여기에는 메서드를 호출할 때마다 생성되는 프레임이 쌓이게 됩니다. 이 프레임 안에는 해당 메서드의 지역 변수, 매개변수, 그리고 메서드의 리턴 값 등이 저장됩니다.\
스택은 **후입선출(LIFO)** 구조로 동작하기 때문에, 메서드 호출이 끝나면 해당 프레임은 스택에서 제거됩니다.

다음으로 `힙`은 **모든 스레드가 공유하는 런타임 데이터 영역**입니다. 객체와 배열이 이 힙 영역에 저장됩니다.\
힙의 특징은 동적으로 메모리가 할당되고 해제된다는 점입니다. 더 이상 사용되지 않는 객체는 가비지 컬렉터에 의해 자동으로 메모리에서 제거됩니다.\
힙은 보통 `Young Generation`과 `Old Generation`으로 나뉘어 관리되는데, 이는 가비지 컬렉션의 효율을 높이기 위함입니다.

마지막으로 `메서드 영역`은 **클래스의 구조, 메서드의 코드, 클래스 변수(static 변수)** 등이 저장되는 곳입니다.\
JVM이 시작될 때 생성되며, 모든 스레드가 이 영역을 공유합니다. 또한, 런타임 상수 풀이라고 하는, 상수 값들을 저장하는 영역도 메서드 영역에 포함됩니다.



### Q. 그렇다면 자바에서 메모리 누수(Memory Leak)가 발생하는 원인과 이를 방지하는 방법에 대해 설명해주세요.

자바에서 메모리 누수가 발생하는 주요 원인과 이를 방지하는 방법은 다음과 같습니다.

첫째, **정적 필드가 객체를 참조**하면 해당 객체는 프로그램이 종료될 때까지 메모리에 계속 남아있게 되어 가비지 컬렉션의 대상이 되지 않습니다. 이는 불필요한 메모리 사용을 초래할 수 있습니다.\
이를 방지하기 위해서는 더 이상 필요하지 않은 객체의 참조를 명시적으로 `null`로 설정해주는 것이 좋습니다.

둘째, **파일이나 네트워크 연결 같은 리소스를 적절히 닫지 않으면** 메모리 누수가 발생할 수 있습니다.\
이를 방지하기 위해 `try-with-resources` 구문을 사용하거나, `finally 블록`에서 리소스를 명시적으로 해제해주는 것이 좋습니다.

셋째, **`equals()`와 `hashCode()` 메서드의 잘못된 구현**으로 인한 메모리 누수입니다.\
이 메서드들이 제대로 구현되지 않으면 `HashSet`이나 `HashMap` 같은 자료구조에서 중복 객체가 계속 추가될 수 있습니다.\
이를 방지하기 위해서는 `equals()`와 `hashCode()` 메서드를 올바르게 오버라이드해야 합니다.

넷째, 내부 클래스와 익명 클래스의 숨은 참조로 인한 메모리 누수입니다. 내부 클래스는 외부 클래스의 인스턴스를 암묵적으로 참조하여 메모리 누수를 일으킬 수 있습니다.\
이를 방지하기 위해서는 가능한 정적 내부 클래스를 사용하거나, 외부 클래스 참조가 필요 없는 경우 익명 클래스 대신 람다 표현식을 사용하는 것이 좋습니다.

다섯째, **캐시의 부적절한 사용**으로 인한 메모리 누수입니다. 객체 참조를 캐시에 넣고 제거하지 않으면 메모리 누수가 발생할 수 있습니다.\
이를 방지하기 위해서는 `WeakHashMap`을 사용하거나, 주기적으로 캐시를 정리하는 로직을 구현하는 것이 좋습니다.

마지막으로, **리스너나 콜백을 제거하지 않아 발생하는** 메모리 누수입니다. 더 이상 필요 없는 리스너나 콜백을 제거하지 않으면 메모리 누수가 발생할 수 있습니다.\
이를 방지하기 위해서는 리스너나 콜백이 더 이상 필요 없을 때 명시적으로 제거해주어야 합니다.

이러한 방법들을 통해 자바에서의 메모리 누수를 효과적으로 방지하고 관리할 수 있습니다.
